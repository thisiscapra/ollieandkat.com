(function(){function n(n){var r=n||{};this.d=this.c=t,n.visible==undefined&&(n.visible=e),n.shadow==undefined&&(n.shadow="7px -3px 5px rgba(88,88,88,0.7)"),n.anchor==undefined&&(n.anchor=d.BOTTOM),this.setValues(r)}function r(e,t){var n=document.createElement("DIV");n.innerHTML=t;if(n.childNodes.length==1)return n.removeChild(n.firstChild);for(var r=document.createDocumentFragment();n.firstChild;)r.appendChild(n.firstChild);return r}function i(e,t){if(t)for(var n;n=t.firstChild;)t.removeChild(n)}function s(e,t){if(e.c){var n="";if(navigator.userAgent.indexOf("Gecko/")!==-1)t=="dragging"&&(n="-moz-grabbing"),t=="dragready"&&(n="-moz-grab");else if(t=="dragging"||t=="dragready")n="move";t=="draggable"&&(n="pointer"),e.a.style.cursor!=n&&(e.a.style.cursor=n)}}function o(n,r){if(n.getDraggable()&&!n.d){n.d=e;var i=n.getMap();n.m=i.get("draggable"),i.set("draggable",t),n.h=r.clientX,n.i=r.clientY,s(n,"dragready"),n.a.style.MozUserSelect="none",n.a.style.KhtmlUserSelect="none",n.a.style.WebkitUserSelect="none",n.a.unselectable="on",n.a.onselectstart=function(){return t},c(n),google.maps.event.trigger(n,"dragstart")}}function u(e){e.getDraggable()&&e.d&&(e.d=t,e.getMap().set("draggable",e.m),e.h=e.i=e.m=null,e.a.style.MozUserSelect="",e.a.style.KhtmlUserSelect="",e.a.style.WebkitUserSelect="",e.a.unselectable="off",e.a.onselectstart=function(){},h(e),s(e,"draggable"),google.maps.event.trigger(e,"dragend"),e.draw())}function a(e,t){if(!e.getDraggable()||!e.d)u(e);else{var n=e.h-t.clientX,r=e.i-t.clientY;e.h=t.clientX,e.i=t.clientY,n=parseInt(e.a.style.left,10)-n,r=parseInt(e.a.style.top,10)-r,e.a.style.left=n+"px",e.a.style.top=r+"px";var i=p(e);e.setPosition(e.getProjection().fromDivPixelToLatLng(new google.maps.Point(n-i.width,r-i.height))),s(e,"dragging"),google.maps.event.trigger(e,"drag")}}function f(e){e.f&&(google.maps.event.removeListener(e.f),delete e.f),s(e,"")}function l(e,t){t&&(e.f=google.maps.event.addDomListener(t,"mousedown",function(t){o(e,t)}),s(e,"draggable"))}function c(t){t.a.setCapture?(t.a.setCapture(e),t.e=[google.maps.event.addDomListener(t.a,"mousemove",function(e){a(t,e)},e),google.maps.event.addDomListener(t.a,"mouseup",function(){u(t),t.a.releaseCapture()},e)]):t.e=[google.maps.event.addDomListener(window,"mousemove",function(e){a(t,e)},e),google.maps.event.addDomListener(window,"mouseup",function(){u(t)},e)]}function h(e){if(e.e){for(var t=0,n;n=e.e[t];t++)google.maps.event.removeListener(n);e.e.length=0}}function p(e){var t=e.l();if(typeof t=="object")return t;var n=new google.maps.Size(0,0);if(!e.b)return n;var r=e.b.offsetWidth;e=e.b.offsetHeight;switch(t){case d.TOP:n.width=-r/2;break;case d.TOP_RIGHT:n.width=-r;break;case d.LEFT:n.height=-e/2;break;case d.MIDDLE:n.width=-r/2,n.height=-e/2;break;case d.RIGHT:n.width=-r,n.height=-e/2;break;case d.BOTTOM_LEFT:n.height=-e;break;case d.BOTTOM:n.width=-r/2,n.height=-e;break;case d.BOTTOM_RIGHT:n.width=-r,n.height=-e}return n}var e=!0,t=!1;n.prototype=new google.maps.OverlayView,window.RichMarker=n,n.prototype.getVisible=function(){return this.get("visible")},n.prototype.getVisible=n.prototype.getVisible,n.prototype.setVisible=function(e){this.set("visible",e)},n.prototype.setVisible=n.prototype.setVisible,n.prototype.s=function(){this.c&&(this.a.style.display=this.getVisible()?"":"none",this.draw())},n.prototype.visible_changed=n.prototype.s,n.prototype.setFlat=function(e){this.set("flat",!!e)},n.prototype.setFlat=n.prototype.setFlat,n.prototype.getFlat=function(){return this.get("flat")},n.prototype.getFlat=n.prototype.getFlat,n.prototype.p=function(){return this.get("width")},n.prototype.getWidth=n.prototype.p,n.prototype.o=function(){return this.get("height")},n.prototype.getHeight=n.prototype.o,n.prototype.setShadow=function(e){this.set("shadow",e),this.g()},n.prototype.setShadow=n.prototype.setShadow,n.prototype.getShadow=function(){return this.get("shadow")},n.prototype.getShadow=n.prototype.getShadow,n.prototype.g=function(){this.c&&(this.a.style.boxShadow=this.a.style.webkitBoxShadow=this.a.style.MozBoxShadow=this.getFlat()?"":this.getShadow())},n.prototype.flat_changed=n.prototype.g,n.prototype.setZIndex=function(e){this.set("zIndex",e)},n.prototype.setZIndex=n.prototype.setZIndex,n.prototype.getZIndex=function(){return this.get("zIndex")},n.prototype.getZIndex=n.prototype.getZIndex,n.prototype.t=function(){this.getZIndex()&&this.c&&(this.a.style.zIndex=this.getZIndex())},n.prototype.zIndex_changed=n.prototype.t,n.prototype.getDraggable=function(){return this.get("draggable")},n.prototype.getDraggable=n.prototype.getDraggable,n.prototype.setDraggable=function(e){this.set("draggable",!!e)},n.prototype.setDraggable=n.prototype.setDraggable,n.prototype.k=function(){this.c&&(this.getDraggable()?l(this,this.a):f(this))},n.prototype.draggable_changed=n.prototype.k,n.prototype.getPosition=function(){return this.get("position")},n.prototype.getPosition=n.prototype.getPosition,n.prototype.setPosition=function(e){this.set("position",e)},n.prototype.setPosition=n.prototype.setPosition,n.prototype.q=function(){this.draw()},n.prototype.position_changed=n.prototype.q,n.prototype.l=function(){return this.get("anchor")},n.prototype.getAnchor=n.prototype.l,n.prototype.r=function(e){this.set("anchor",e)},n.prototype.setAnchor=n.prototype.r,n.prototype.n=function(){this.draw()},n.prototype.anchor_changed=n.prototype.n,n.prototype.setContent=function(e){this.set("content",e)},n.prototype.setContent=n.prototype.setContent,n.prototype.getContent=function(){return this.get("content")},n.prototype.getContent=n.prototype.getContent,n.prototype.j=function(){if(this.b){i(this,this.b);var e=this.getContent();if(e){typeof e=="string"&&(e=e.replace(/^\s*([\S\s]*)\b\s*$/,"$1"),e=r(this,e)),this.b.appendChild(e);var n=this;e=this.b.getElementsByTagName("IMG");for(var s=0,o;o=e[s];s++)google.maps.event.addDomListener(o,"mousedown",function(e){n.getDraggable()&&(e.preventDefault&&e.preventDefault(),e.returnValue=t)}),google.maps.event.addDomListener(o,"load",function(){n.draw()});google.maps.event.trigger(this,"domready")}this.c&&this.draw()}},n.prototype.content_changed=n.prototype.j,n.prototype.onAdd=function(){this.a||(this.a=document.createElement("DIV"),this.a.style.position="absolute"),this.getZIndex()&&(this.a.style.zIndex=this.getZIndex()),this.a.style.display=this.getVisible()?"":"none";if(!this.b){this.b=document.createElement("DIV"),this.a.appendChild(this.b);var t=this;google.maps.event.addDomListener(this.b,"click",function(){google.maps.event.trigger(t,"click")}),google.maps.event.addDomListener(this.b,"mouseover",function(){google.maps.event.trigger(t,"mouseover")}),google.maps.event.addDomListener(this.b,"mouseout",function(){google.maps.event.trigger(t,"mouseout")})}this.c=e,this.j(),this.g(),this.k();var n=this.getPanes();n&&n.overlayImage.appendChild(this.a),google.maps.event.trigger(this,"ready")},n.prototype.onAdd=n.prototype.onAdd,n.prototype.draw=function(){if(!!this.c&&!this.d){var e=this.getProjection();if(e){var t=this.get("position");e=e.fromLatLngToDivPixel(t),t=p(this),this.a.style.top=e.y+t.height+"px",this.a.style.left=e.x+t.width+"px",e=this.b.offsetHeight,t=this.b.offsetWidth,t!=this.get("width")&&this.set("width",t),e!=this.get("height")&&this.set("height",e)}}},n.prototype.draw=n.prototype.draw,n.prototype.onRemove=function(){this.a&&this.a.parentNode&&this.a.parentNode.removeChild(this.a),f(this)},n.prototype.onRemove=n.prototype.onRemove;var d={TOP_LEFT:1,TOP:2,TOP_RIGHT:3,LEFT:4,MIDDLE:5,RIGHT:6,BOTTOM_LEFT:7,BOTTOM:8,BOTTOM_RIGHT:9};window.RichMarkerPosition=d})();